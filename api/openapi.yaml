openapi: 3.1.2
info:
  title: Favorite Game Gauntlet
  version: 1.0.0
paths:


  /users/{name}:
    parameters:
      - $ref: "#/components/parameters/UserName"
    post:
      operationId: createUser
      tags:
        - Users
      responses:
        '200':
          description: User was created successfully and returned in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDto"
        '409':
          description: User already exists with the same name.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while creating user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
    get:
      operationId: getUser
      tags:
        - Users
      responses:
        '200':
          description: The user was found and returned successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDto"
        '404':
          description: No user found with the given name.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"

  /users/{userId}/games/unplayed:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: addUnplayedGames
      tags:
        - Games
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnplayedGamesDto"
      responses:
        '200':
          description: Unplayed games were saved successfully.
        '404':
          description: User not found when saving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while saving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
    get:
      operationId: getUnplayedGames
      tags:
        - Games
      responses:
        '200':
          description: Unplayed games were retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnplayedGamesDto"
        '404':
          description: User not found when retrieving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/games/roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: makeGameRoll
      tags:
        - Games
      responses:
        '200':
          description: A game roll was performed and the selected game returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GameDto"
        '404':
          description: User not found or no unplayed games available.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '409':
          description: Game roll not allowed due to current game state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while rolling for a game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/games/current:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getCurrentGame
      tags:
        - Games
      responses:
        '200':
          description: The userâ€™s current game was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GameDto"
        '404':
          description: Current game not found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/games/current/finish:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: finishCurrentGame
      tags:
        - Games
      responses:
        '200':
          description: Current game was marked as finished successfully.
        '404':
          description: No current game found for the user to finish.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while finishing current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/games/current/cancel:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: cancelCurrentGame
      tags:
        - Games
      responses:
        '200':
          description: Current game was marked as cancelled successfully.
        '404':
          description: No current game found for the user to cancel.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while cancelling current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/games/history:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getGameHistory
      tags:
        - Games
      responses:
        '200':
          description: Game history was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GamesDto"
        '404':
          description: No game history found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving game history.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"


  /users/{userId}/timers/current:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getCurrentTimer
      tags:
        - Timers
      responses:
        '200':
          description: The current timer was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimerDto"
        '404':
          description: No active timer found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving current timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/timers/current/start:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: startCurrentTimer
      tags:
        - Timers
      responses:
        '200':
          description: Timer was started or resumed successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimerActionDto"
        '404':
          description: No current timer found to start.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '409':
          description: Timer cannot be started due to incorrect state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while starting timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/timers/current/pause:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: pauseCurrentTimer
      tags:
        - Timers
      responses:
        '200':
          description: Timer was paused successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimerActionDto"
        '404':
          description: No current timer found to pause.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '409':
          description: Timer cannot be paused due to incorrect state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while pausing timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/effects/has-roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: checkEffectRoll
      tags:
        - Effects
      responses:
        '200':
          description: Boolean indicating whether the user has available effect rolls.
          content:
            application/json:
              schema:
                type: boolean
        '404':
          description: User not found when checking effect roll.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while checking effect roll.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/effects/history:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getEffectHistory
      tags:
        - Effects
      responses:
        '200':
          description: Effect history retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EffectsDto"
        '404':
          description: No effect history found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while retrieving effect history.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"



  /users/{userId}/effects/roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: makeEffectRoll
      tags:
        - Effects
      responses:
        '200':
          description: Effect roll performed successfully and returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EffectDto"
        '404':
          description: User not found or effect roll unavailable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '409':
          description: Effect roll not allowed due to current game or timer state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"
        '503':
          description: Service unavailable while rolling for effects.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Exception"


components:

  parameters:
    UserId:
      name: userId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Id"
    UserName:
      name: name
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Name"

  schemas:
    Id:
      type: string
      format: uuid
    Name:
      type: string
    UserDto:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/Id"
        name:
          $ref: "#/components/schemas/Name"
      required:
        - id
        - name
    UnplayedGameDto:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        link:
          type: string
          format: hostname
          example: "https://store.steampowered.com/app/20"
      required:
        - name
    UnplayedGamesDto:
      type: array
      items:
        $ref: '#/components/schemas/UnplayedGameDto'
    GameDto:
      allOf:
        - $ref: "#/components/schemas/UnplayedGameDto"
        - type: object
          properties:
            state:
              type: string
              enum: [ 'started', 'finished', 'cancelled' ]
            finishDate:
              type: string
              format: date-time
          required:
            - state
    GamesDto:
      type: array
      items:
        $ref: '#/components/schemas/GameDto'
    TimerDto:
      type: object
      properties:
        state:
          type: string
          enum: [ 'created', 'running', 'paused', 'finished', 'rolled' ]
        remainingTimeInS:
          type: integer
          format: int
        durationInS:
          type: integer
          format: int
        timerActionDate:
          type: string
          format: date-time
      required:
        - state
        - remainingTimeInS
        - durationInS
    TimerActionDto:
      type: object
      properties:
        action:
          type: string
          enum: [ 'start', 'pause', 'stop' ]
        remainingTimeInS:
          type: integer
          format: int
      required:
        - action
        - remainingTimeInS
    EffectDto:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        receivedDate:
          type: string
          format: date-time
        gameName:
          $ref: "#/components/schemas/Name"
      required:
        - name
        - description
        - receivedDate
    EffectsDto:
      type: array
      items:
        $ref: '#/components/schemas/EffectDto'

    Exception:
      type: object
      properties:
        code:
          type: string
          enum: [
            "USER_NOT_FOUND", "GAME_NOT_FOUND", "TIMER_NOT_FOUND",
            "NO_AVAILABLE_ROLLS", "USER_ALREADY_EXISTS", "TIMER_INCORRECT_STATE",
            "UNEXPECTED", "CHECK_USER", "CHECK_CURRENT_GAME", "CHECK_CURRENT_TIMER",
            "GET_USER", "GET_UNPLAYED_GAMES", "GET_CURRENT_GAME", "GET_CURRENT_TIMER",
            "CREATE_USER", "ADD_UNPLAYED_GAMES", "START_CURRENT_TIMER", "PAUSE_CURRENT_TIMER",
            "FINISH_CURRENT_GAME", "GET_GAME_HISTORY", "CURRENT_GAME_ALREADY_EXISTS",
            "MAKE_GAME_ROLL", "CANCEL_CURRENT_GAME"
          ]
        message:
          type: string
      required:
        - code
        - message
