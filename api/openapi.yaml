openapi: 3.1.2
info:
  title: Favorite Game Gauntlet
  version: 0.1.0
paths:


  /users/{name}:
    parameters:
      - $ref: "#/components/parameters/UserName"
    post:
      operationId: createUser
      tags:
        - Users
      summary: Create user
      description: |
        Create a user and get an ID that must be passed in order to execute commands.
      responses:
        '200':
          description: User was created successfully and returned in response.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        '409':
          description: User already exists with the same name.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while creating user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"
    get:
      operationId: getUser
      tags:
        - Users
      summary: Get user ID
      description: |
        Enter your username to get the ID that you need to pass in order to execute commands.
      responses:
        '200':
          description: The user was found and returned successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        '404':
          description: No user found with the given name.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"

  /users/{userId}/games/unplayed:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: addUnplayedGames
      tags:
        - Games
      summary: Add game wishlist
      description: |
        Add the games you want to play here.<br>
        You can use another command to get a random game from this list.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnplayedGames"
      responses:
        '200':
          description: Unplayed games were saved successfully.
        '404':
          description: User not found when saving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while saving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"
    get:
      operationId: getUnplayedGames
      tags:
        - Games
      summary: Get game wishlist
      description: |
        You can see the games you might get here.<br>
        You can use another command to get a random game from this list.
      responses:
        '200':
          description: Unplayed games were retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnplayedGames"
        '404':
          description: User not found when retrieving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving unplayed games.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/games/roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: makeGameRoll
      tags:
        - Games
      summary: Select a random game from the wishlist
      description: |
        Select a random game from your unplayed list.<br>
        The selected game will become the current game.<br>
        You will then be able to start the timer.
      responses:
        '200':
          description: A game roll was performed and the selected game returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Game"
        '404':
          description: User not found or no unplayed games available.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '409':
          description: Game roll not allowed due to current game state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while rolling for a game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/games/current:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getCurrentGame
      tags:
        - Games
      summary: Get the current game
      description: |
        You can find out information and status of the current game.
      responses:
        '200':
          description: The userâ€™s current game was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Game"
        '404':
          description: Current game not found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/games/current/finish:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: finishCurrentGame
      tags:
        - Games
      summary: Complete the current game
      description: |
        You can complete the current game if you have completed it according to the FGG rules.<br>
        When you complete the game, you will receive a bonus that depends on the number of hours spent playing.
      responses:
        '200':
          description: Current game was marked as finished successfully.
        '404':
          description: No current game found for the user to finish.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while finishing current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/games/current/cancel:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: cancelCurrentGame
      tags:
        - Games
      summary: Cancel the current game
      description: |
        You can cancel the current game if you do not intend to complete it for any reason.<br>
        If you cancel a game, you will receive a fixed penalty.
      responses:
        '200':
          description: Current game was marked as cancelled successfully.
        '404':
          description: No current game found for the user to cancel.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while cancelling current game.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/games/history:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getGameHistory
      tags:
        - Games
      summary: Get a list of all games played
      description: |
        You can get a complete list of all the games that were randomly selected from your wishlist,<br>
        as well as all the information about them.
      responses:
        '200':
          description: Game history was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Games"
        '404':
          description: No game history found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving game history.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"


  /users/{userId}/timers/current:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getCurrentTimer
      tags:
        - Timers
      summary: Get a timer for the current game
      description: |
        If you don't have a timer, one will be created.<br>
        If you already have one, you'll receive it.
      responses:
        '200':
          description: The current timer was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Timer"
        '404':
          description: No active timer found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving current timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/timers/current/start:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: startCurrentTimer
      tags:
        - Timers
      summary: Start or continue the current timer
      description: |
        Start or continue the timer from the current game.<br>
        If the timer is already running, nothing will happen.
      responses:
        '200':
          description: Timer was started or resumed successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimerAction"
        '404':
          description: No current timer found to start.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '409':
          description: Timer cannot be started due to incorrect state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while starting timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/timers/current/pause:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: pauseCurrentTimer
      tags:
        - Timers
      summary: Pause the current timer
      description: |
        Pause the timer from the current game.<br>
        If the timer is already paused, nothing will happen.
      responses:
        '200':
          description: Timer was paused successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimerAction"
        '404':
          description: No current timer found to pause.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '409':
          description: Timer cannot be paused due to incorrect state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while pausing timer.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/effects/has-roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: checkEffectRoll
      tags:
        - Effects
      summary: Check if there are any effect rolls available
      description: |
        You can find out if you have any available effect rolls.<br>
        If the value is "true," you have one.<br>
        If the value is "false," you don't.
      responses:
        '200':
          description: Boolean indicating whether the user has available effect rolls.
          content:
            application/json:
              schema:
                type: boolean
        '404':
          description: User not found when checking effect roll.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while checking effect roll.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/effects/history:
    parameters:
      - $ref: "#/components/parameters/UserId"
    get:
      operationId: getEffectHistory
      tags:
        - Effects
      summary: Get a list of all effect rolls
      description: |
        You can get a list of all effect rolls that have been received or rolled,
        as well as all the information about them.
      responses:
        '200':
          description: Effect history retrieved successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Effects"
        '404':
          description: No effect history found for the user.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '500':
          description: Service unavailable while retrieving effect history.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/effects/roll:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: makeEffectRoll
      tags:
        - Effects
      summary: Make the roll of the effect available
      description: |
        The function is currently not working.<br>
        <br>
        Allows you to obtain a random effect from those that haven't dropped yet.<br>
        A list of available effects can be obtained using another command.
      responses:
        '200':
          description: Effect roll performed successfully and returned.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Effect"
        '404':
          description: User not found or effect roll unavailable.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotFoundError"
        '409':
          description: Effect roll not allowed due to current game or timer state.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while rolling for effects.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"



  /users/{userId}/effects/available:
    parameters:
      - $ref: "#/components/parameters/UserId"
    post:
      operationId: getAvailableEffects
      tags:
        - Effects
      summary: Get a list of effects available for rolling
      description: |
        The function is currently not working.<br>
        <br>
        You can get a list of effects that are available to drop using the throw effects command.
      responses:
        '200':
          description: List of available effects successfully retrieved.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AvailableEffect"
        '404':
          description: User not found or available effects data missing.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConflictError"
        '500':
          description: Service unavailable while retrieving available effects.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InternalServerError"


components:

  parameters:
    UserId:
      name: userId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Id"
    UserName:
      name: name
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/Name"

  schemas:
    Id:
      type: string
      format: uuid
    Name:
      type: string
    User:
      type: object
      properties:
        id:
          $ref: "#/components/schemas/Id"
        name:
          $ref: "#/components/schemas/Name"
      required: [ id, name]
    UnplayedGame:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        link:
          type: string
          format: hostname
          example: "https://store.steampowered.com/app/20"
      required: [ name ]
    UnplayedGames:
      type: array
      items:
        $ref: '#/components/schemas/UnplayedGame'
    Game:
      allOf:
        - $ref: "#/components/schemas/UnplayedGame"
        - type: object
          properties:
            state:
              type: string
              enum: [ 'started', 'finished', 'cancelled' ]
            hourCount:
              type: integer
              format: int
            finishDate:
              type: string
              format: date-time
          required: [ state ]
    Games:
      type: array
      items:
        $ref: '#/components/schemas/Game'
    Timer:
      type: object
      properties:
        state:
          type: string
          enum: [ 'created', 'running', 'paused', 'finished' ]
        remainingTimeInS:
          type: integer
          format: int
        durationInS:
          type: integer
          format: int
        timerActionDate:
          type: string
          format: date-time
      required: [ state, remainingTimeInS, durationInS ]
    TimerAction:
      type: object
      properties:
        type:
          type: string
          enum: [ 'start', 'pause', 'stop' ]
        remainingTimeInS:
          type: integer
          format: int
      required: [ type, remainingTimeInS ]
    Effect:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        createDate:
          type: string
          format: date-time
        rollDate:
          type: string
          format: date-time
        gameName:
          $ref: "#/components/schemas/Name"
      required: [ createDate ]
    Effects:
      type: array
      items:
        $ref: '#/components/schemas/Effect'
    AvailableEffect:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
      required: [ name ]

    NotFoundError:
      type: object
      properties:
        code:
          type: string
          enum: [
            "GAME_NOT_FOUND",
            "TIMER_NOT_FOUND",
            "USER_NOT_FOUND"
          ]
        message:
          type: string
      required: [ code, message ]
      example:
        code: "USER_NOT_FOUND"
        message: ""
    ConflictError:
      type: object
      properties:
        code:
          type: string
          enum: [
            "CURRENT_GAME_ALREADY_EXISTS",
            "NO_AVAILABLE_ROLLS",
            "TIMER_INCORRECT_STATE",
            "USER_ALREADY_EXISTS"
          ]
        message:
          type: string
      required: [ code, message ]
    InternalServerError:
      type: object
      properties:
        code:
          type: string
          enum: [
            "UNEXPECTED_DATABASE"
          ]
        message:
          type: string
      required: [ code, message ]
