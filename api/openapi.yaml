openapi: 3.1.2
info:
  title: Favorite Game Gauntlet
  version: 0.3.1
paths:

  /auth/signup:
    post:
      operationId: signUp
      tags: [ Auth ]
      summary: Register a new user account
      description: |
        Creates a new user by providing a unique name, valid email address, and password.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewUser'
      responses:
        '200':
          description: User account successfully created.
        '401':
          description: Invalid authentication data provided.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '409':
          description: A user with the given email or name already exists.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /auth/login:
    post:
      operationId: login
      tags: [ Auth ]
      summary: Log in an existing user
      description: |
        Authenticates a user using their name and password and returns an active session.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: User successfully authenticated.
          headers:
            Set-Cookie:
             schema:
               type: string
             description: Session cookie
        '401':
          description: Incorrect name or password.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /auth/logout:
    post:
      operationId: logout
      tags: [ Auth ]
      summary: Log out the current user
      description: |
        Ends the active user session and invalidates authentication.
      responses:
        '200':
          description: User successfully logged out.
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Session cookie
        '401':
          description: No active session found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/unplayed:
    post:
      operationId: addUnplayedGames
      tags:
        - Games
      summary: Add game wishlist
      description: |
        Add the games you want to play here.<br>
        You can use another command to get a random game from this list.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UnplayedGames'
      responses:
        '200':
          description: Unplayed games were saved successfully.
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Unplayed games data not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'
    get:
      operationId: getUnplayedGames
      tags:
        - Games
      summary: Get game wishlist
      description: |
        You can see the games you might get here.<br>
        You can use another command to get a random game from this list.
      responses:
        '200':
          description: Unplayed games were retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnplayedGames'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Unplayed games data not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/roll:
    post:
      operationId: makeGameRoll
      tags:
        - Games
      summary: Select a random game from the wishlist
      description: |
        Select a random game from your unplayed list.<br>
        The selected game will become the current game.<br>
        You will then be able to start the timer.
      responses:
        '200':
          description: A game roll was performed and the selected game returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No unplayed games available for rolling.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '409':
          description: Game roll not allowed due to current game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/current:
    get:
      operationId: getCurrentGame
      tags:
        - Games
      summary: Get the current game
      description: |
        You can find out information and status of the current game.
      responses:
        '200':
          description: The userâ€™s current game was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Game'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Current game not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/current/finish:
    post:
      operationId: finishCurrentGame
      tags:
        - Games
      summary: Complete the current game
      description: |
        You can complete the current game if you have completed it according to the FGG rules.<br>
        When you complete the game, you will receive a bonus that depends on the number of hours spent playing.
      responses:
        '200':
          description: Current game was marked as finished successfully.
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No current game available to finish.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '409':
          description: Game finishing not allowed due to lack of completed timers for the game.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/current/cancel:
    post:
      operationId: cancelCurrentGame
      tags:
        - Games
      summary: Cancel the current game
      description: |
        You can cancel the current game if you do not intend to complete it for any reason.<br>
        If you cancel a game, you will receive a fixed penalty.
      responses:
        '200':
          description: Current game was marked as cancelled successfully.
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No current game available to cancel.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /games/history:
    get:
      operationId: getGameHistory
      tags:
        - Games
      summary: Get a list of all games played
      description: |
        You can get a complete list of all the games that were randomly selected from your wishlist,<br>
        as well as all the information about them.
      responses:
        '200':
          description: Game history was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Games'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Game history not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'


  /timers/current:
    get:
      operationId: getCurrentTimer
      tags:
        - Timers
      summary: Get a timer for the current game
      description: |
        If you don't have a timer, one will be created.<br>
        If you already have one, you'll receive it.
      responses:
        '200':
          description: The current timer was retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Timer'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No active timer found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /timers/current/start:
    post:
      operationId: startCurrentTimer
      tags:
        - Timers
      summary: Start or continue the current timer
      description: |
        Start or continue the timer from the current game.<br>
        If the timer is already running, nothing will happen.
      responses:
        '200':
          description: Timer was started or resumed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimerAction'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No timer available to start.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '409':
          description: Timer cannot be started due to incorrect state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /timers/current/pause:
    post:
      operationId: pauseCurrentTimer
      tags:
        - Timers
      summary: Pause the current timer
      description: |
        Pause the timer from the current game.<br>
        If the timer is already paused, nothing will happen.
      responses:
        '200':
          description: Timer was paused successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimerAction'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No timer available to pause.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '409':
          description: Timer cannot be paused due to incorrect state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /effects/has-roll:
    get:
      operationId: checkAvailableEffectRoll
      tags:
        - Effects
      summary: Check if there are any effect rolls available
      description: |
        You can find out if you have any available effect rolls.<br>
        If the value is 'true,' you have one.<br>
        If the value is 'false,' you don't.
      responses:
        '200':
          description: Boolean indicating whether the user has available effect rolls.
          content:
            application/json:
              schema:
                type: boolean
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Effect roll information not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /effects/history:
    get:
      operationId: getEffectHistory
      tags:
        - Effects
      summary: Get a list of all effect rolls
      description: |
        You can get a list of all effect rolls that have been received or rolled,
        as well as all the information about them.
      responses:
        '200':
          description: Effect history retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RolledEffects'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Effect history not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /effects/roll:
    post:
      operationId: makeEffectRoll
      tags:
        - Effects
      summary: Make the roll of the effect available
      description: |
        Allows you to obtain a random effect from those that haven't dropped yet.<br>
        A list of available effects can be obtained using another command.
      responses:
        '200':
          description: Effect roll performed successfully and returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RolledEffects'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: No available effects to roll.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFoundError'
        '409':
          description: Effect roll not allowed due to current game or timer state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



  /effects/available:
    post:
      operationId: getAvailableEffects
      tags:
        - Effects
      summary: Get a list of effects available for rolling
      description: |
        You can get a list of effects that are available to drop using the throw effects command.
      responses:
        '200':
          description: List of available effects successfully retrieved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Effects'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotAuthorizedError'
        '404':
          description: Available effects data not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternalServerError'



components:

  parameters:
    UserId:
      name: userId
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/Id'
    UserName:
      name: name
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/Name'

  schemas:
    Id:
      type: integer
      format: int

    Name:
      type: string
      pattern: '^[A-Za-z0-9_]+$'
      minLength: 3
      maxLength: 35

    Password:
      type: string
      pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]$'
      minLength: 8
      maxLength: 35

    Email:
      type: string
      pattern: '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'
      minLength: 6
      maxLength: 35

    NewUser:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/Name'
        email:
          $ref: '#/components/schemas/Email'
        password:
          $ref: '#/components/schemas/Password'
      required: [ name, email, password ]

    User:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/Name'
        password:
          $ref: '#/components/schemas/Password'
      required: [ name, password ]

    UnplayedGame:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/Name'
        link:
          type: string
          format: hostname
          example: 'https://store.steampowered.com/app/20'
      required: [ name ]

    UnplayedGames:
      type: array
      items:
        $ref: '#/components/schemas/UnplayedGame'

    Game:
      allOf:
        - $ref: '#/components/schemas/UnplayedGame'
        - type: object
          properties:
            state:
              type: string
              enum: [ 'started', 'finished', 'cancelled' ]
            hourCount:
              type: integer
              format: int
            finishDate:
              type: string
              format: date-time
          required: [ state, hourCount ]

    Games:
      type: array
      items:
        $ref: '#/components/schemas/Game'

    Timer:
      type: object
      properties:
        state:
          type: string
          enum: [ 'created', 'running', 'paused', 'finished' ]
        remainingTimeInS:
          type: integer
          format: int
        durationInS:
          type: integer
          format: int
        timerActionDate:
          type: string
          format: date-time
      required: [ state, remainingTimeInS, durationInS ]

    TimerAction:
      type: object
      properties:
        type:
          type: string
          enum: [ 'start', 'pause', 'stop' ]
        remainingTimeInS:
          type: integer
          format: int
      required: [ type, remainingTimeInS ]

    Effect:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/Name'
        description:
          type: string
      required: [ name ]

    Effects:
      type: array
      items:
        $ref: '#/components/schemas/Effect'

    RolledEffect:
      allOf:
        - $ref: '#/components/schemas/Effect'
        - type: object
          properties:
            rollDate:
              type: string
              format: date-time
          required: [ rollDate ]

    RolledEffects:
      type: array
      items:
        $ref: '#/components/schemas/RolledEffect'



    NotAuthorizedError:
      type: object
      properties:
        code:
          type: string
          enum: [
            'NO_ACTIVE_SESSION',
            'WRONG_AUTH_DATA'
          ]
        message:
          type: string
      required: [ code, message ]

    NotFoundError:
      type: object
      properties:
        code:
          type: string
          enum: [
            'GAME_NOT_FOUND',
            'TIMER_NOT_FOUND',
            'USER_NOT_FOUND'
          ]
        message:
          type: string
      required: [ code, message ]
      example:
        code: 'USER_NOT_FOUND'
        message: ''

    ConflictError:
      type: object
      properties:
        code:
          type: string
          enum: [
            'CURRENT_GAME_ALREADY_EXISTS',
            'EMAIL_ALREADY_EXISTS',
            'NO_AVAILABLE_ROLLS',
            'NO_COMPLETED_TIMERS',
            'NO_UNPLAYED_GAMES',
            'SESSION_ALREADY_EXISTS',
            'TIMER_INCORRECT_STATE',
            'USERNAME_ALREADY_EXISTS'
          ]
        message:
          type: string
      required: [ code, message ]

    InternalServerError:
      type: object
      properties:
        code:
          type: string
          enum: [
            'UNEXPECTED'
          ]
        message:
          type: string
      required: [ code, message ]
